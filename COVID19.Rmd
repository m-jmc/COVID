---
title: "COVID-19"
author: "Mike"
date: "3/12/2020"
output: 
  html_document:
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r, echo=FALSE,include=FALSE}

library(tidyverse)
library(lubridate)
library(reshape2)
library(viridis)
library(ggthemes)

data <- read_csv("time_series_covid_19_confirmed.csv")

data.save <- data

data <- data[,-c(1,3,4)]

# Sum is required for the two "yes" responses added above
data <- data %>%
          group_by(`Country/Region`) %>% 
          summarise_all(list(sum))

# Melt into long form
data <- melt(data)

# Rename columns
colnames(data)[colnames(data)=="variable"] <- "date"
colnames(data)[colnames(data)=="value"] <- "count"

# Date to char for parsing and conversion
data$date <- as.character(data$date)

# Parse the date
data$year<-sapply(data$date, function(x) as.numeric(strsplit(x,"/")[[1]][3]))
data$month<-sapply(data$date, function(x) as.numeric(strsplit(x,"/")[[1]][1]))
data$day<-sapply(data$date, function(x) as.numeric(strsplit(x,"/")[[1]][2]))

# Put us back in the year 2000
data$year <- (data$year + 2000)

# Reformat date
data$date<-as.Date(paste0(data$year,'-',data$month,'-',data$day), format="%Y-%m-%d")

# Add some weekdays for good measure
data$weekday <- weekdays(as.Date(data$date))

# Put weekdays in order
data$weekday <- ordered(data$weekday, levels=c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))

# Set X axis limits ----------------------------------------------------------- Must update with data refresh
time <- as.POSIXct(strptime(c("2020-01-22","2020-03-11"), format = "%y-%m-%d"))


p <- data %>% 
     ggplot(aes(day,`Country/Region`, fill=count))+
            geom_tile(color= "white",size=0.1) + 
            scale_fill_viridis(name="Confirmed Cases",option ="C")
p <-p + facet_grid(month)

plot(p)






```

## Including Plots

You can also embed plots, for example:

```{r, echo=FALSE, warnings=FALSE}

trend <- data %>% filter(`Country/Region` %in% c("China","Mainland China","Italy","US","Korea, South")) %>%
  group_by(date, count) %>%
  ggplot(aes(x=as.POSIXct(date),y=count, color=`Country/Region`)) + 
  geom_point(size=1) + 
  geom_line(alpha=.5,size=1) + 
  scale_x_datetime(limits =time) + 
  labs(title="Total Confirmed Case Count") +
  xlab("Date") + 
  ylab("Cases")
  
plot(trend)
  
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
























